"use strict";(self.webpackChunkosism=self.webpackChunkosism||[]).push([[5136],{5639:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>g,frontMatter:()=>a,metadata:()=>t,toc:()=>c});var i=s(5893),r=s(1151);const a={sidebar_label:"Kubernetes",sidebar_position:200},l="Kubernetes",t={id:"kubernetes",title:"Kubernetes",description:"Erstellung von einem Kubernetes Cluster",source:"@site/docs/kubernetes.md",sourceDirName:".",slug:"/kubernetes",permalink:"/docs/kubernetes",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:200,frontMatter:{sidebar_label:"Kubernetes",sidebar_position:200},sidebar:"docSidebar",previous:{title:"DNS",permalink:"/docs/dns"},next:{title:"API",permalink:"/docs/api"}},d={},c=[{value:"Erstellung von einem Kubernetes Cluster",id:"erstellung-von-einem-kubernetes-cluster",level:2},{value:"Nutzung von einem Kubernetes Cluster",id:"nutzung-von-einem-kubernetes-cluster",level:2},{value:"Web Terminal",id:"web-terminal",level:3},{value:"Kubeconfig",id:"kubeconfig",level:3},{value:"Ausrollen von Diensten (Beispiele)",id:"ausrollen-von-diensten-beispiele",level:3},{value:"Kubectl",id:"kubectl",level:4},{value:"Helm",id:"helm",level:4}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"kubernetes",children:"Kubernetes"}),"\n",(0,i.jsx)(n.h2,{id:"erstellung-von-einem-kubernetes-cluster",children:"Erstellung von einem Kubernetes Cluster"}),"\n",(0,i.jsx)("img",{src:s(1680).Z,width:"100%"}),"\n",(0,i.jsx)("img",{src:s(4259).Z,width:"100%"}),"\n",(0,i.jsx)(n.h2,{id:"nutzung-von-einem-kubernetes-cluster",children:"Nutzung von einem Kubernetes Cluster"}),"\n",(0,i.jsx)(n.h3,{id:"web-terminal",children:"Web Terminal"}),"\n",(0,i.jsx)(n.h3,{id:"kubeconfig",children:"Kubeconfig"}),"\n",(0,i.jsxs)(n.p,{children:["Das Credential Plugin ",(0,i.jsx)(n.a,{href:"https://github.com/gardener/gardenlogin#installation",children:"gardenlogin"}),"\nsowie die ",(0,i.jsx)(n.a,{href:"https://github.com/gardener/gardenctl-v2/#install-using-package-managers",children:"CLI f\xfcr Gardener"}),"\nund ",(0,i.jsx)(n.a,{href:"https://github.com/int128/kubelogin",children:"kubelogin"})," muss vorab installiert werden."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Homebrew (macOS and Linux)\nbrew install gardener/tap/gardenctl-v2\nbrew install gardener/tap/gardenlogin\nbrew install int128/kubelogin/kubelogin\n\n# Chocolatey (Windows)\nchoco install gardenctl-v2\nchoco install gardenlogin\nchoco install kubelogin\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Eine personalisierte Kubeconfig f\xfcr ein Projekt ",(0,i.jsx)(n.code,{children:"PROJECT"})," kann von\n",(0,i.jsx)(n.a,{href:"https://dashboard.okeanos.tech/account?namespace=garden-PROJECT",children:"https://dashboard.okeanos.tech/account?namespace=garden-PROJECT"})," herunterladen und in einer lokalen Datei\nabgelegt werden. Zum Beispiel in ",(0,i.jsx)(n.code,{children:"~/.kube/garden-okeanos"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'$ gardenctl config set-garden okeanos --kubeconfig "~/.kube/garden-okeanos"\nSuccessfully configured garden "okeanos"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Das vorherige Kommando erstellt die Datei ",(0,i.jsx)(n.code,{children:"~/.garden/gardenctl-v2.yaml"})," mit folgendem Inhalt:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"gardens:\n- identity: okeanos\n  kubeconfig: ~/.kube/garden-okeanos\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Die Kubeconfig f\xfcr ein Kubernetes Cluster ",(0,i.jsx)(n.code,{children:"CLUSTER"})," in einem Projekt ",(0,i.jsx)(n.code,{children:"PROJECT"})," ist unter ",(0,i.jsx)(n.code,{children:"Access"})," bei\n",(0,i.jsx)(n.code,{children:"Kubeconfig - Gardenlogin"})," abgelegt. Diese Kubeconfig herunterladen (oder den Inhalt kopieren) und in\neiner lokalen Datei ablegen. Zum Beispiel in ",(0,i.jsx)(n.code,{children:"~/.kube/config-pfee6i4v2j"})," wenn der Name des Clusters\n",(0,i.jsx)(n.code,{children:"pfee6i4v2j"})," ist."]}),"\n",(0,i.jsxs)(n.p,{children:["Wenn mehrere Projekte genutzt werden und dadurch bedingt mehrere Eintr\xe4ge in ",(0,i.jsx)(n.code,{children:"~/.garden/gardenctl-v2.yaml"}),"\nvorhanden sind ist es wichtig in dieser Kubeconfig eine \xc4nderung vorzunehmen. Der Eintrag\n",(0,i.jsx)(n.code,{children:"gardenClusterIdentity"})," ist per Default auf ",(0,i.jsx)(n.code,{children:"okeanos"})," gesetzt und muss entsprechend angepasst werden. Wenn z.B.\neine weiterer Eintrag ",(0,i.jsx)(n.code,{children:"demo"})," in ",(0,i.jsx)(n.code,{children:"~/.garden/gardenctl-v2.yaml"})," vorhanden ist und genutzt werden soll dann\nwird ",(0,i.jsx)(n.code,{children:"gardenClusterIdentity"})," entsprechend auf ",(0,i.jsx)(n.code,{children:"gardenClusterIdentity: demo"})," ge\xe4ndert."]}),"\n",(0,i.jsxs)(n.p,{children:["Anschliessend kann z.B. ",(0,i.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/kubectl/",children:"kubectl"})," wie gewohnt verwendet werden."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"$ export KUBECONFIG=~/.kube/config-pfee6i4v2j\n$ kubectl get nodes\nNAME                                                        STATUS   ROLES    AGE   VERSION\nshoot--PROJECT--CLUSTER-worker-g096a-z1-758bb-rmdfh   Ready    <none>   77m   v1.27.9\nshoot--PROJECT--CLUSTER-worker-iaz3a-z1-6c9cd-jx84f   Ready    <none>   87m   v1.27.9\n"})}),"\n",(0,i.jsx)(n.h3,{id:"ausrollen-von-diensten-beispiele",children:"Ausrollen von Diensten (Beispiele)"}),"\n",(0,i.jsxs)(n.p,{children:["Diverse Dienste bzw. Applikationen k\xf6nnen mit Hilfe von ",(0,i.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/tools/#kubectl",children:"kubectl"})," oder beispielsweise ",(0,i.jsx)(n.a,{href:"https://helm.sh/docs/helm/helm_install/",children:"helm"})," installiert werden."]}),"\n",(0,i.jsx)(n.h4,{id:"kubectl",children:"Kubectl"}),"\n",(0,i.jsxs)(n.p,{children:["Ein essenzieller Teil eines Kubernetes-Clusters ist die Erreichbarkeit von au\xdfen. Um dies zu erreichen muss ein ",(0,i.jsx)(n.code,{children:"Service"})," sowie ",(0,i.jsx)(n.code,{children:"Ingress"})," erstellt werden."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ kubectl create namespace nginx\nnamespace/nginx created\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="nginx-svc.yaml"',children:"apiVersion: v1\nkind: Service\nmetadata:\n  name: nginx-service\n  namespace: nginx\nspec:\n  selector:\n    app: nginx\n  ports:\n    - port: 80\n      targetPort: 80\n  type: LoadBalancer\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ kubectl apply -f nginx-svc.yaml\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Die ",(0,i.jsx)(n.code,{children:"External-IP"})," des Loadbalancers kann \xfcber ",(0,i.jsx)(n.code,{children:"kubectl get svc nginx-service -n nginx"})," in Erfahrung gebracht werden."]}),"\n",(0,i.jsx)(n.p,{children:"Der Ingress dient dabei als Vermittler zwischen dem eingehenden Traffic und dem Service"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="nginx-ingress.yaml"',children:"apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: nginx-ingress\n  annotations:\n    nginx.ingress.kubernetes.io/proxy-body-size: 4G\nspec:\n  ingressClassName: nginx\n  rules:\n  - http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n          service:\n            name: nginx\n            port:\n              number: 80\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ kubectl apply -f nginx-ingress.yaml\n"})}),"\n",(0,i.jsx)(n.p,{children:"Um nginx selbst auszurollen, muss ein Deployment erstellt werden:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="nginx-deployment.yaml"',children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  selector:\n    matchLabels:\n      app: nginx\n  replicas: 2 # tells deployment to run 2 pods matching the template\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.14.2\n        ports:\n        - containerPort: 80\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ kubectl apply -f nginx-deployment.yaml --namespace nginx\n"})}),"\n",(0,i.jsx)(n.p,{children:"Um alles wieder abzurei\xdfen, kann folgender Befehl benutzt werden:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ kubectl delete all --all --namespace nginx\n"})}),"\n",(0,i.jsx)(n.h4,{id:"helm",children:"Helm"}),"\n",(0,i.jsxs)(n.p,{children:["Einfacher geht das ganze noch, wenn Helm benutzt wird. Dabei wird automatisch ein Service f\xfcr den Dienst erstellt.\nAusserdem kann, in den meisten F\xe4llen, innerhalb der ",(0,i.jsx)(n.code,{children:"Values"})," ein ",(0,i.jsx)(n.code,{children:"Ingress"})," konfiguriert werden. Zuvor muss jedoch,\nebenfalls per Helm, ein Ingress mit dem Type ",(0,i.jsx)(n.code,{children:"Loadbalancer"})," erstellt werden, damit eine \xf6ffentliche IP Adresse f\xfcr den\nnachfolgenden Dienst existiert."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="ingress-values.yaml"',children:'controller:\n  allowSnippetAnnotations: true\n  podLabels:\n    app: nginx-ingress\n    component: controller\n  extraArgs:\n    enable-ssl-passthrough: ""\n  config:\n    use-http2: true\n  service:\n    type: "LoadBalancer"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx\n$ helm repo update\n$ helm upgrade -i ingress-nginx -f ingress-values.yaml --create-namespace -n ingress-nginx ingress-nginx/ingress-nginx\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="nginx-values.yaml"',children:'cloneStaticSiteFromGit:\n  enabled: true\n  repository: "https://github.com/regiocloud/sample-website"\n  branch: "main"\n  interval: 3600\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ helm upgrade -i nginx -f nginx-values.yaml --create-namespace -n nginx oci://registry-1.docker.io/bitnamicharts/nginx\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Die Values in ",(0,i.jsx)(n.code,{children:"nginx-values.yaml"})," dienen nur als Beispiel. Hier wird eine statische Website ausgeliefert. Alle m\xf6glichen\nValues f\xfcr das Helm Chart finden sich in der ",(0,i.jsx)(n.a,{href:"https://github.com/bitnami/charts/blob/main/bitnami/nginx/values.yaml",children:"values.yaml"}),"\ndes Helm Charts selbst."]}),"\n",(0,i.jsxs)(n.p,{children:["Die Erstellung des Loadbalancers nimmt einige Zeit in Anspruch. Mit dem nachfolgendem Kommando kann darauf gewartet werden.\nSobald der Loadbalancer verf\xfcgbar ist wird in der Spalte ",(0,i.jsx)(n.code,{children:"EXTERNAL-IP"})," die \xf6ffentlich erreichbare IP Adresse des Loadbalancers\nhinterlegt. Das Kommand kann dann mit ",(0,i.jsx)(n.code,{children:"STRG+C"})," beendet werden."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ kubectl get svc --namespace nginx -w nginx\nNAME    TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE\nnginx   LoadBalancer   100.90.239.115   <pending>     80:31627/TCP   58s\nnginx   LoadBalancer   100.90.239.115   <pending>     80:31627/TCP   2m12s\nnginx   LoadBalancer   100.90.239.115   81.163.193.251   80:31627/TCP   2m12s\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Die Beispiel Website ist dann \xfcber die IP Adresse in der Spalte ",(0,i.jsx)(n.code,{children:"EXTERNAL-IP"})," \xfcber einen beliebigen Browser aufrufbar."]}),"\n",(0,i.jsx)(n.p,{children:"Zum Abrei\xdfen des Charts, kann folgender Befehl benutzt werden:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'$ helm uninstall nginx -n nginx\nrelease "nginx" uninstalled\n'})}),"\n",(0,i.jsx)(n.p,{children:"Der Loadbalancer kann wie folgt entfernt werden:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'$ helm uninstall ingress-nginx -n ingress-nginx\nrelease "ingress-nginx" uninstalled\n'})})]})}function g(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},1680:(e,n,s)=>{s.d(n,{Z:()=>i});const i=s.p+"assets/images/gardener-create-cluster-1-0a3557ab9e7f5c7d66a58378eb7b9c3d.png"},4259:(e,n,s)=>{s.d(n,{Z:()=>i});const i=s.p+"assets/images/gardener-create-cluster-2-56f352ecc5585d6c7aba8ab2240e98d3.png"},1151:(e,n,s)=>{s.d(n,{Z:()=>t,a:()=>l});var i=s(7294);const r={},a=i.createContext(r);function l(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);