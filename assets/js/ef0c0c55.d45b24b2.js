"use strict";(self.webpackChunkosism=self.webpackChunkosism||[]).push([[6409],{9061:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>d,toc:()=>l});var t=r(5893),s=r(1151);const i={"SPDX-License-Identifier":"MIT",date:"2021-08-11",last_modified:"2023-12-05",title:"Installation und Konfiguration der Monitoring-L\xf6sung Prometheus",short_description:"Dieses Tutorial beschreibt die Installation und Konfiguration von Prometheus, Node_exporter und Grafana",tags:["Debian","Prometheus"],authors:{name:"Florian Bauer",url:"https://github.com/fsrv-xyz",image_url:"https://avatars.githubusercontent.com/u/35347506"},source_url:"https://github.com/hetzneronline/community-content/tree/master/tutorials/install-and-configure-prometheus-stack"},a=void 0,d={id:"hetzner-community/install-and-configure-prometheus-stack",title:"Installation und Konfiguration der Monitoring-L\xf6sung Prometheus",description:"Dieses Tutorial wurde urspr\xfcnglich von Florian Bauer am 2021-08-11 in",source:"@site/tutorials/hetzner-community/install-and-configure-prometheus-stack.md",sourceDirName:"hetzner-community",slug:"/hetzner-community/install-and-configure-prometheus-stack",permalink:"/tutorials/hetzner-community/install-and-configure-prometheus-stack",draft:!1,unlisted:!1,tags:[{label:"Debian",permalink:"/tutorials/tags/debian"},{label:"Prometheus",permalink:"/tutorials/tags/prometheus"}],version:"current",frontMatter:{"SPDX-License-Identifier":"MIT",date:"2021-08-11",last_modified:"2023-12-05",title:"Installation und Konfiguration der Monitoring-L\xf6sung Prometheus",short_description:"Dieses Tutorial beschreibt die Installation und Konfiguration von Prometheus, Node_exporter und Grafana",tags:["Debian","Prometheus"],authors:{name:"Florian Bauer",url:"https://github.com/fsrv-xyz",image_url:"https://avatars.githubusercontent.com/u/35347506"},source_url:"https://github.com/hetzneronline/community-content/tree/master/tutorials/install-and-configure-prometheus-stack"},sidebar:"tutorialsSidebar",previous:{title:"Hetzner Community",permalink:"/tutorials/hetzner-community/"}},o={},l=[{value:"Einf\xfchrung",id:"einf\xfchrung",level:2},{value:"Schritt 1 - Installation von Node Exporter auf dem zu \xfcberwachenden Server",id:"schritt-1---installation-von-node-exporter-auf-dem-zu-\xfcberwachenden-server",level:2},{value:"Schritt 2 - Installation des Prometheus Servers auf dem \xfcberwachenden Server",id:"schritt-2---installation-des-prometheus-servers-auf-dem-\xfcberwachenden-server",level:2},{value:"Schritt 3 - Installation von Grafana auf dem \xfcberwachenden Server",id:"schritt-3---installation-von-grafana-auf-dem-\xfcberwachenden-server",level:2},{value:"Schritt 4 - Konfiguration des Grafana-Servers",id:"schritt-4---konfiguration-des-grafana-servers",level:2},{value:"Ergebnis",id:"ergebnis",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["Dieses Tutorial wurde urspr\xfcnglich von ",(0,t.jsx)(n.a,{href:"https://github.com/fsrv-xyz",children:"Florian Bauer"})," am 2021-08-11 in\n",(0,t.jsx)(n.a,{href:"https://github.com/hetzneronline/community-content/tree/master/tutorials/install-and-configure-prometheus-stack",children:"hetzneronline/community-content"})," ver\xf6ffentlicht. Die letzten \xc4nderungen wurden am\n2023-12-05 gemacht."]})}),"\n",(0,t.jsx)(n.h2,{id:"einf\xfchrung",children:"Einf\xfchrung"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://prometheus.io",children:"Prometheus"})," ist eine Software, welche es erlaubt, die Metriken von vielen verschiedenen Quellen wie Webservern, Systemauslastung oder auch Netzwerkhardware abzurufen und zu speichern."]}),"\n",(0,t.jsxs)(n.p,{children:["Dieses Tutorial beschreibt, wie die Performance-Daten eines Servers mit Prometheus abgefragt und mit ",(0,t.jsx)(n.a,{href:"https://grafana.com",children:"Grafana"})," ausgewertet werden k\xf6nnen."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Voraussetzungen"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"2 Server mit Debian 11"}),"\n",(0,t.jsxs)(n.li,{children:["Freigabe des TCP-Ports 9100 in der ",(0,t.jsx)(n.a,{href:"https://regiocloud.github.io/docs/netzwerk",children:"Security Group"})," f\xfcr den ",(0,t.jsx)(n.strong,{children:"zu \xfcberwachenden Server"})]}),"\n",(0,t.jsxs)(n.li,{children:["Freigabe des TCP-Ports 3000 in der ",(0,t.jsx)(n.a,{href:"https://regiocloud.github.io/docs/netzwerk",children:"Security Group"})," f\xfcr den ",(0,t.jsx)(n.strong,{children:"\xfcberwachenden Server"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Aufbau des Systems"})}),"\n",(0,t.jsxs)(n.p,{children:["In den folgenden Schritten wird ",(0,t.jsx)(n.strong,{children:"node1.example.com"})," als Beispiel f\xfcr den ",(0,t.jsx)(n.strong,{children:"zu \xfcberwachenden Server"})," verwendet und ",(0,t.jsx)(n.strong,{children:"prometheus.example.com"})," als Beispiel f\xfcr den ",(0,t.jsx)(n.strong,{children:"\xfcberwachenden Server"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"schritt-1---installation-von-node-exporter-auf-dem-zu-\xfcberwachenden-server",children:"Schritt 1 - Installation von Node Exporter auf dem zu \xfcberwachenden Server"}),"\n",(0,t.jsxs)(n.p,{children:["Der Prometheus-Stack besteht aus mehreren Komponenten. Prometheus stellt hierbei den Speicher sowie das Sammeln der Metriken von diversen Endpunkten bereit. Diese Endpunkte k\xf6nnen von jeder Software angeboten werden. Eine Liste der Exporter und integrierten Schnittstellen kann ",(0,t.jsx)(n.a,{href:"https://prometheus.io/docs/instrumenting/exporters/",children:"hier"})," eingesehen werden."]}),"\n",(0,t.jsxs)(n.p,{children:["F\xfcr dieses Tutorial wird die Software ",(0,t.jsx)(n.a,{href:"https://github.com/prometheus/node_exporter",children:"Node Exporter"})," genutzt, welche Metriken \xfcber System-Ressourcen wie Prozessorauslastung, Netzwerknutzung oder Festplattenaktivit\xe4t ausliest."]}),"\n",(0,t.jsx)(n.p,{children:"Auf dem zu \xfcberwachenden Server muss f\xfcr die Installation folgendes ausgef\xfchrt werden:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"apt update\napt install prometheus-node-exporter\n"})}),"\n",(0,t.jsx)(n.p,{children:"Die Metriken-Schnittstelle des Exporters sollte nun auf dem TCP-Port 9100 antworten. HTTP-Clients, wie beispielsweise curl, k\xf6nnen somit Metriken anfragen."}),"\n",(0,t.jsx)(n.p,{children:"Mit folgendem Befehl erhalten Sie aktuelle Werte \xfcber Systemd-Units."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'root@node1.example.com:~# curl -s http://127.0.0.1:9100/metrics | grep node_systemd_units\n# HELP node_systemd_units Summary of systemd unit states\n# TYPE node_systemd_units gauge\nnode_systemd_units{state="activating"} 0\nnode_systemd_units{state="active"} 146\nnode_systemd_units{state="deactivating"} 0\nnode_systemd_units{state="failed"} 0\nnode_systemd_units{state="inactive"} 70\n'})}),"\n",(0,t.jsx)(n.h2,{id:"schritt-2---installation-des-prometheus-servers-auf-dem-\xfcberwachenden-server",children:"Schritt 2 - Installation des Prometheus Servers auf dem \xfcberwachenden Server"}),"\n",(0,t.jsx)(n.p,{children:"In diesem Beispiel wird der Prometheus Server dazu genutzt, die vom Node Exporter bereitgestellten Metriken in die integrierte Datenbank OpenTSDB abzulegen. Die Installation des Servers l\xe4uft wie folgt ab:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"apt update\napt install prometheus jq\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Prometheus bezieht seine Konfiguration aus einer im Format Yaml abgelegten Datei. Darin sind unter anderem die Adresse der zu \xfcberwachenden Endpunkte sowie das Intervall angegeben, nach dem die Werte periodisch abgerufen werden. Bearbeiten Sie den ",(0,t.jsx)(n.code,{children:"scrape_configs"}),"-Abschnitt in der ",(0,t.jsx)(n.code,{children:"/etc/prometheus/prometheus.yml"}),"-Datei wie folgt:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"scrape_configs:\n  - job_name: 'node_exporter at node1'\n    static_configs:\n      - targets: ['node1.example.com:9100']\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"job_name"})," der Name des Jobs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"static_configs"})," beinhaltet die Konfiguration f\xfcr Hosts mit statischer IP"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"targets"})," enth\xe4lt eine oder mehrere ",(0,t.jsx)(n.code,{children:"<host>:<port>"}),"-Paare, zu denen eine Verbindung aufgebaut werden soll"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Abschlie\xdfend muss der Prometheus-Service neu geladen werden."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"systemctl reload prometheus.service\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Mit ",(0,t.jsx)(n.code,{children:"systemctl status prometheus"})," kann gepr\xfcft werden, ob das Neuladen des Services erfolgreich war."]}),"\n",(0,t.jsx)(n.p,{children:"Um den Status der zu \xfcberwachenden Server anzuzeigen, kann folgender Befehl ausgef\xfchrt werden:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"root@prometheus.example.com:~# curl --silent 127.0.0.1:9090/api/v1/targets | jq -r '.data.activeTargets[]|.scrapeUrl,.health,.lastError'\n"})}),"\n",(0,t.jsx)(n.p,{children:"Im Output sollte Ihnen folgende Information angezeigt werden:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"http://node1.example.com:9100/metrics\nup\n"})}),"\n",(0,t.jsx)(n.h2,{id:"schritt-3---installation-von-grafana-auf-dem-\xfcberwachenden-server",children:"Schritt 3 - Installation von Grafana auf dem \xfcberwachenden Server"}),"\n",(0,t.jsx)(n.p,{children:"Da die Metriken der zu \xfcberwachenden Knoten durchgehend vom Prometheus Server abgerufen und f\xfcr 15 Tage gespeichert werden, k\xf6nnen die Daten \xfcber mehrere Wege angezeigt/ausgewertet werden.\nIn diesem Tutorial benutzen wir Grafana, welches Dashboards f\xfcr viele verschiedene Datenquellen \xfcber ein Webinterface bereitstellt."}),"\n",(0,t.jsxs)(n.p,{children:["Die Aktivierung des Grafana-Repositories sowie die nachfolgende Installation auf ",(0,t.jsx)(n.strong,{children:"prometheus.example.com"})," wird wie folgt durchgef\xfchrt:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'apt install apt-transport-https software-properties-common wget\nwget -q -O - https://packages.grafana.com/gpg.key | apt-key add -\necho "deb https://apt.grafana.com stable main" > /etc/apt/sources.list.d/grafana.list\n\napt update\napt install grafana\n'})}),"\n",(0,t.jsx)(n.p,{children:"Aktivieren und starten Sie nun abschlie\xdfend den Grafana-Daemon:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"systemctl enable grafana-server.service\nsystemctl start grafana-server.service\n"})}),"\n",(0,t.jsx)(n.h2,{id:"schritt-4---konfiguration-des-grafana-servers",children:"Schritt 4 - Konfiguration des Grafana-Servers"}),"\n",(0,t.jsx)(n.p,{children:"Der Grafana-Server stellt ein Webinterface bereit. Beachten Sie, dass die Sicherheitseinstellungen f\xfcr Grafana noch nicht eingerichtet wurden. Solange die Verbindung zwischen Ihrem Browser und dem Dashboard-Server nicht sicher ist, verwenden Sie nur Zugangsdaten, die sich f\xfcr Testzwecke eignen."}),"\n",(0,t.jsx)(n.p,{children:"Auf das Webinterface kann \xfcber folgende URL zugegriffen werden:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-url",children:"http://prometheus.example.com:3000/\n"})}),"\n",(0,t.jsx)(n.p,{children:"Die Default-Zugangsdaten sind:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Nutzername: ",(0,t.jsx)(n.strong,{children:"admin"})]}),"\n",(0,t.jsxs)(n.li,{children:["Passwort: ",(0,t.jsx)(n.strong,{children:"admin"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Nachdem Sie sich das erste Mal eingeloggt haben, k\xf6nnen Sie das Passwort \xe4ndern."}),"\n",(0,t.jsx)(n.p,{children:"Zu diesem Zeitpunkt sind noch keine Datenquellen oder Dashboards eingerichtet. F\xfcgen Sie als erstes eine Datenquelle hinzu."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Grafana: &quot;Configuration&quot; menu with selected &quot;Data sources&quot; menuitem",src:r(5144).Z+"",width:"800",height:"800"})}),"\n",(0,t.jsxs)(n.p,{children:['W\xe4hlen Sie als "Data source" Typ ',(0,t.jsx)(n.code,{children:"Prometheus"})," und geben Sie ",(0,t.jsx)(n.code,{children:"http://localhost:9090"})," im URL-Feld an. W\xe4hlen Sie anschlie\xdfend ",(0,t.jsx)(n.code,{children:"Save & test"})," aus, um die Datenquelle zu erstellen."]}),"\n",(0,t.jsx)(n.p,{children:"Um ein neues Dashboard zu erstellen, k\xf6nnen Sie zwischen zwei M\xf6glichkeiten w\xe4hlen:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Erstellung individueller Panels und Dashboards"}),"\n",(0,t.jsx)(n.li,{children:"Import bereits von der Community angelegter Vorlagen"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Um die gespeicherten Metriken des ",(0,t.jsx)(n.code,{children:"node_exporters"})," anzuzeigen, kann dieses bereits ",(0,t.jsx)(n.a,{href:"https://grafana.com/grafana/dashboards/1860",children:"vordefinierte Dashboard"})," verwendet werden."]}),"\n",(0,t.jsx)(n.p,{children:"Kopieren Sie die ID, um das Dashboard in Ihr Grafana zu importieren."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Grafana: &quot;Dashboards&quot; menu with selected &quot;+ Import&quot; menuitem",src:r(1255).Z+"",width:"800",height:"800"})}),"\n",(0,t.jsxs)(n.p,{children:["W\xe4hlen Sie ",(0,t.jsx)(n.strong,{children:"+ Import"})," aus, f\xfcgen Sie die kopierte ID ein und klicken Sie auf ",(0,t.jsx)(n.strong,{children:"Load"}),".\nW\xe4hlen Sie die Prometheus-Datenquelle f\xfcr das Dashboard aus:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Grafana: Import dashboard &quot;Node Exporter Full&quot;",src:r(9077).Z+"",width:"800",height:"800"})}),"\n",(0,t.jsx)(n.p,{children:"Nun ist das Dashboard importiert und zeigt die bisher gespeicherten Daten des zu \xfcberwachenden Servers an."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Grafana: &quot;Node Exporter Full&quot; dashboard with data",src:r(5771).Z+"",width:"800",height:"800"})}),"\n",(0,t.jsx)(n.h2,{id:"ergebnis",children:"Ergebnis"}),"\n",(0,t.jsx)(n.p,{children:"In diesem Tutorial wurde ein Prometheus-Stack aufgesetzt, um die Performance-Daten eines Servers auszulesen, abzufragen und grafisch darzustellen. Mit diesem Setup besteht die Basis f\xfcr die \xdcberwachung zahlreicher Dienste und Knoten."}),"\n",(0,t.jsxs)(n.p,{children:["Wenn Sie die ",(0,t.jsx)(n.code,{children:"prometheus.yml"}),"-Datei bearbeiten, um unter dem ",(0,t.jsx)(n.code,{children:"scrape_configs"}),"-Bereich einen neuen Job hinzuzuf\xfcgen, k\xf6nnen Sie neben dem ",(0,t.jsx)(n.code,{children:"static_configs"}),"-Parameter, mit welchem die Informationen von einer bestimmten IP-Adresse abgefragt werden, auch eine weitere Option nutzen. Prometheus bietet zus\xe4tzlich auch eine Reihe an ",(0,t.jsx)(n.a,{href:"https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config",children:"offiziellen Service-Discovery-Mechanismen"}),". Mit diesen ist es m\xf6glich, verf\xfcgbare Host dynamisch von Prometheus erkennen und automatisch als Targets hinzuf\xfcgen zu lassen."]})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},5144:(e,n,r)=>{r.d(n,{Z:()=>t});const t=r.p+"assets/images/grafana-configuration-menu-with-selected-data_sources-menuitem-2b3892728043fcb773f9e5f55c711d0a.png"},1255:(e,n,r)=>{r.d(n,{Z:()=>t});const t=r.p+"assets/images/grafana-dashboards-menu-with-selected-import-menuitem-52a9c5a1c3a6a5ffaa856b979644bfdf.png"},9077:(e,n,r)=>{r.d(n,{Z:()=>t});const t=r.p+"assets/images/grafana-import-dashboard-node_exporter_full-472ce765ace842eff047ad9bdbf2d651.png"},5771:(e,n,r)=>{r.d(n,{Z:()=>t});const t=r.p+"assets/images/grafana-node_exporeter_full-dashboard-with-data-042ae56553fe74b28037457eaa5f6c1c.png"},1151:(e,n,r)=>{r.d(n,{Z:()=>d,a:()=>a});var t=r(7294);const s={},i=t.createContext(s);function a(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);